<!DOCTYPE html>
<html>
	<head>
		<title>SpaceHacks</title>
		<link rel="stylesheet" type="text/css" href="mission/style/reset.css">
		<link rel="stylesheet/less" type="text/css" href="mission/style/main.less">
		<script type="text/javascript" src="mission/lib/less.min.js"></script>
		<!--<link rel="icon" type="img/png" href="style/favicon.png" style="width:30px;">-->
		<link href="https://fonts.googleapis.com/css?family=Bungee|Open+Sans:400,800" rel="stylesheet">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="https://www.gstatic.com/firebasejs/3.6.1/firebase.js"></script>
	</head>
	<body>

		<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.8&appId=1681466342126424";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>

		<h1>SpaceHacks</h1>
		<h3>Your Game ID: <span id="gid">...</span></h3>

		<h1>Choose Your Role</h1>

		<h3>VR Companion Controller</h3>

		<div class="centerbox">
			<button id="engineering">Engineering</button>
			<button id="control">Mission Control</button>
		</div>
		
		
		<h3>Mission Control Manual</h3>
		<div class="fb-send" data-href="https://developers.facebook.com/docs/plugins/"></div>

		<h3>Made at WildHacks 2016</h3>

		<script type="text/javascript" src="mission/lib/infra.js"></script>
		<script type="text/javascript" src="mission/lib/main.js"></script>

		<script type="text/javascript">

			window.ROOM_KEY = false;

			function ClickEvent(id, fn){
				document.getElementById(id).addEventListener('click', function(e){fn(e)});
			}

			function main(){
				var promise = db.ref('games').push({timestamp: Date.now()});
				promise.then(function(data){

					//window.ROOM_KEY = promise.path['o'][1];
					window.ROOM_KEY = 'vinesh';
					/*var gameWindow = window.open('spacehacks/graphics/index.html?gid=' + window.ROOM_KEY, 'SpaceHacks');
					console.log(gameWindow)
					gameWindow.initGame(window.ROOM_KEY);*/
					

					document.getElementById('gid').innerText = window.ROOM_KEY;

					ClickEvent('control', function(){
						var controlWindow = window.open('mission/control.html?gid=' + window.ROOM_KEY, 'SpaceHacks');
					});

					var game_url = window.location.origin + 'spacehacks/graphics/index.html?gid=' + window.ROOM_KEY;
					console.log(game_url)

					var companion = document.getElementById('engineering');
					companion.addEventListener('click', function(e){
						FB.ui({
							method: 'send',
							name: 'SpaceHacks',
							link: game_url,
						});
					});

				});
			}

			main();

		</script>
		
	</body>
</html>